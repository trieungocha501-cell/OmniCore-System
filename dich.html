<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tr√¨nh d·ªãch ƒëa ng√¥n ng·ªØ(20+ ng√¥n ng·ªØ)</title>
    <script src="https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); background-color: #fff; }
        h2 { text-align: center; color: #333; }
        label { font-weight: bold; display: block; margin-top: 15px; margin-bottom: 5px; }
        
        /* √î nh·∫≠p li·ªáu c√≥ Mic */
        .input-group { position: relative; width: 100%; }
        textarea { width: 100%; height: 100px; padding: 10px; padding-right: 45px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; resize: vertical; }
        .mic-btn { position: absolute; right: 10px; top: 10px; background: none; border: none; cursor: pointer; font-size: 24px; color: #007bff; }
        .mic-active { color: red; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        select { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; background-color: #f9f9f9; }
        button#main-btn { background: #007bff; color: white; border: none; padding: 15px; cursor: pointer; border-radius: 5px; margin-top: 20px; font-weight: bold; width: 100%; font-size: 16px; text-transform: uppercase; }
        
        #status { color: #666; font-style: italic; margin-top: 10px; height: 20px; text-align: center; }
        .result { background: #f9f9f9; padding: 15px; border-left: 5px solid #007bff; min-height: 40px; margin-top: 10px; white-space: pre-wrap; border-radius: 0 5px 5px 0; font-size: 18px; }

        /* L·ªãch s·ª≠ d·ªãch */
        .history-box { margin-top: 30px; border-top: 2px dashed #eee; padding-top: 15px; }
        .history-item { font-size: 14px; background: #f1f1f1; padding: 8px; margin-bottom: 5px; border-radius: 4px; border-left: 3px solid #ccc; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Tr√¨nh d·ªãch ƒëa ng√¥n ng·ªØ(20+ ng√¥n ng·ªØ)</h2>

    <label>Nh·∫≠p vƒÉn b·∫£n:</label>
    <div class="input-group">
        <textarea id="inputText" placeholder="Nh·∫≠p n·ªôi dung ho·∫∑c b·∫•m Mic ƒë·ªÉ n√≥i..."></textarea>
        <button class="mic-btn" id="micBtn" onclick="startDictation()">üé§</button>
    </div>

    <label>Ch·ªçn ·∫£nh ch·ª©a ch·ªØ</label>
    <input type="file" id="imageInput" accept="image/*">

    <label>Ch·ªçn ng√¥n ng·ªØ ƒë√≠ch:</label>
    <select id="targetLang">
        <option value="vi">Ti·∫øng Vi·ªát</option>
        <option value="en">Ti·∫øng Anh</option>
        <option value="ja">Ti·∫øng Nh·∫≠t</option>
        <option value="zh-CN">Ti·∫øng Trung (Gi·∫£n th·ªÉ)</option>
        <option value="zh-TW">Ti·∫øng Trung (Ph·ªìn th·ªÉ)</option>
        <option value="de">Ti·∫øng ƒê·ª©c</option>
        <option value="ko">Ti·∫øng H√†n</option>
        <option value="fr">Ti·∫øng Ph√°p</option>
        <option value="ru">Ti·∫øng Nga</option>
        <option value="es">Ti·∫øng T√¢y Ban Nha</option>
        <option value="th">Ti·∫øng Th√°i</option>
        <option value="lo">Ti·∫øng L√†o</option>
        <option value="km">Ti·∫øng Khmer</option>
        <option value="id">Ti·∫øng Indonesia</option>
        <option value="ms">Ti·∫øng M√£ Lai</option>
        <option value="it">Ti·∫øng √ù</option>
        <option value="pt">Ti·∫øng B·ªì ƒê√†o Nha</option>
        <option value="ar">Ti·∫øng ·∫¢ R·∫≠p</option>
        <option value="hi">Ti·∫øng ·∫§n ƒê·ªô (Hindi)</option>
        <option value="tr">Ti·∫øng Th·ªï Nhƒ© K·ª≥</option>
        <option value="nl">Ti·∫øng H√† Lan</option>
        <option value="pl">Ti·∫øng Ba Lan</option>
        <option value="sv">Ti·∫øng Th·ª•y ƒêi·ªÉn</option>
        <option value="el">Ti·∫øng Hy L·∫°p</option>
    </select>

    <button id="main-btn" onclick="processTranslation()">D·ªäCH NGAY</button>

    <div id="status"></div>
    <h3>K·∫øt qu·∫£:</h3>
    <div class="result" id="output"></div>

    <div class="history-box" id="historyBox">
        <label>L·ªãch s·ª≠ g·∫ßn ƒë√¢y:</label>
        <div id="historyList"></div>
    </div>

    <script>
        function startDictation() {
            if (window.hasOwnProperty('webkitSpeechRecognition')) {
                var recognition = new webkitSpeechRecognition();
                recognition.lang = "vi-VN";
                const micIcon = document.getElementById('micBtn');
                micIcon.classList.add('mic-active');
                recognition.start();

                recognition.onresult = function(e) {
                    document.getElementById('inputText').value = e.results[0][0].transcript;
                    micIcon.classList.remove('mic-active');
                    recognition.stop();
                };
                recognition.onerror = () => { micIcon.classList.remove('mic-active'); recognition.stop(); };
            } else {
                alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Mic.");
            }
        }

        async function processTranslation() {
            const textInput = document.getElementById('inputText').value;
            const imageInput = document.getElementById('imageInput').files[0];
            const targetLang = document.getElementById('targetLang').value;
            const outputDiv = document.getElementById('output');
            const statusDiv = document.getElementById('status');

            let textToTranslate = textInput;

            if (imageInput && !textInput) {
                statusDiv.innerText = "ƒêang d·ªãch ·∫£nh...";
                try {
                    const result = await Tesseract.recognize(imageInput, 'eng+vie+jpn+chi_sim+deu');
                    textToTranslate = result.data.text;
                    document.getElementById('inputText').value = textToTranslate;
                } catch (e) {
                    statusDiv.innerText = "";
                    outputDiv.innerText = "kh√¥ng th·ªÉ d·ªãch ·∫£nh";
                    return;
                }
            }

            if (!textToTranslate || !textToTranslate.trim()) {
                alert("Vui l√≤ng nh·∫≠p d·ªØ li·ªáu!");
                return;
            }

            statusDiv.innerText = "ƒêang d·ªãch...";
            try {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(textToTranslate)}`);
                const data = await res.json();
                let translated = "";
                data[0].forEach(item => { if (item[0]) translated += item[0]; });

                outputDiv.innerText = translated;
                statusDiv.innerText = "";
                addHistory(textToTranslate, translated);
            } catch (error) {
                outputDiv.innerText = "l·ªói,kh√¥ng th·ªÉ d·ªãch";
                statusDiv.innerText = "";
            }
        }

        function addHistory(original, translated) {
            const list = document.getElementById('historyList');
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerText = `${original.substring(0,20)}... ‚Üí ${translated.substring(0,20)}...`;
            item.onclick = () => { document.getElementById('inputText').value = original; };
            list.prepend(item);
            if (list.childNodes.length > 5) list.removeChild(list.lastChild);
        }
    </script>
</body>
</html>